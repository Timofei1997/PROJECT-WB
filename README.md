–ö–∞–∫ —è –ø–æ—Å—Ç—Ä–æ–∏–ª ETL-–ø–∞–π–ø–ª–∞–π–Ω –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–¥–∞–∂ Wildberries —Å API, PostgreSQL –∏ Metabase
–ü—Ä–∏–≤–µ—Ç, –•–∞–±—Ä!
–•–æ—á—É –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ–∞–ª—å–Ω—ã–º –∫–µ–π—Å–æ–º, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª –Ω–∞ —Ä–∞–±–æ—Ç–µ: —Å–∏—Å—Ç–µ–º–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–±–æ—Ä–∞ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ Wildberries.
–Ø –Ω–∞–ø–∏—Å–∞–ª Python-—Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π:
‚Ä¢	–∑–∞–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ WB API;
‚Ä¢	–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–∫–∞–∑—ã –∏ –ø—Ä–æ–¥–∞–∂–∏;
‚Ä¢	—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ PostgreSQL;
‚Ä¢	–≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤ Metabase;
‚Ä¢	–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ cron.
–í —Å—Ç–∞—Ç—å–µ –ø–æ–∫–∞–∂—É, –∫–∞–∫ –≤—Å—ë —É—Å—Ç—Ä–æ–µ–Ω–æ –≤–Ω—É—Ç—Ä–∏ ‚Äî —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∫–æ–¥–∞ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π.
________________________________________
üì¶ –ó–∞—á–µ–º –≤—Å—ë —ç—Ç–æ?
–ë–∏–∑–Ω–µ—Å—É –Ω—É–∂–Ω–æ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:
‚Ä¢	–ø—Ä–æ–¥–∞–∂–∏ –∏ –≤–æ–∑–≤—Ä–∞—Ç—ã;
‚Ä¢	–≥–µ–æ–≥—Ä–∞—Ñ–∏—é –∑–∞–∫–∞–∑–æ–≤;
‚Ä¢	–æ—Å—Ç–∞—Ç–∫–∏ –∏ —Ö–æ–¥–æ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏.
–†–∞–Ω—å—à–µ –≤—Å—ë —ç—Ç–æ —Å—á–∏—Ç–∞–ª–æ—Å—å –≤—Ä—É—á–Ω—É—é. –¢–µ–ø–µ—Ä—å –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ BI-—Å–∏—Å—Ç–µ–º–µ –≤ –≤–∏–¥–µ —É–¥–æ–±–Ω—ã—Ö –¥–∞—à–±–æ—Ä–¥–æ–≤.
________________________________________
‚öôÔ∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
‚Ä¢	Python ‚Äî –¥–ª—è ETL-—Å–∫—Ä–∏–ø—Ç–∞
‚Ä¢	requests, pandas, psycopg2 ‚Äî —Ä–∞–±–æ—Ç–∞ —Å API, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è, –∑–∞–≥—Ä—É–∑–∫–∞ –≤ –ë–î
‚Ä¢	PostgreSQL ‚Äî —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
‚Ä¢	Metabase ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
‚Ä¢	cron + Linux-—Å–µ—Ä–≤–µ—Ä ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
________________________________________
üîê –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å Wildberries API
–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤ –∏ –ø—Ä–æ–¥–∞–∂ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π WB API:
ini
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
[Method_API]
WB_GET_ALL_ORDERS = https://statistics-api.wildberries.ru/api/v1/supplier/orders
WB_GET_ALL_SALES = https://statistics-api.wildberries.ru/api/v1/supplier/sales
–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ Python:
python
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
r = rq.get(url=WB_GET_ALL_SALES, headers={"Authorization": token_WB}, params=params)
if r.status_code == 200:
    lst_all_sales = r.json()
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ 429 (–ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤):
python
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
for _ in range(4):
    r = rq.get(...)
    if r.status_code == 429:
        tm.sleep(1.1)
________________________________________
üßπ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
–° –ø–æ–º–æ—â—å—é pandas:
‚Ä¢	–æ—á–∏—â–∞—é –∏ –æ–±—ä–µ–¥–∏–Ω—è—é –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–æ–≤ –∏ –ø—Ä–æ–¥–∞–∂;
‚Ä¢	–¥–æ–±–∞–≤–ª—è—é —Ñ–ª–∞–≥–∏ —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤, –ø—Ä–æ–¥–∞–∂ –∏ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤;
‚Ä¢	–≥—Ä—É–ø–ø–∏—Ä—É—é –ø–æ SKU –∏ –æ–∫—Ä—É–≥–∞–º.
–ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á—ë—Ç–∞ —Ñ–ª–∞–≥–æ–≤:
python
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
df_all_sales["success_sale"] = df_all_sales["saleID"].apply(lambda x: 1 if x[0] == "S" else 0)
df_all_orders["success_order"] = df_all_orders["isCancel"].apply(lambda x: 0 if x else 1)
–ò –∞–≥—Ä–µ–≥–∞—Ü–∏–∏:
python
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
df_sales = df_all_sales.groupby("barcode")[["totalPrice", "success_sale", "success_return"]].sum().reset_index()
df_orders = df_all_orders.groupby("barcode")[["success_order", "success_cancel"]].sum().reset_index()
df_orders_and_sales = df_sales.merge(df_orders, how="outer")
________________________________________
üóÉÔ∏è –ó–∞–≥—Ä—É–∑–∫–∞ –≤ PostgreSQL
–î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î –∏—Å–ø–æ–ª—å–∑—É—é psycopg2. –û–±—ë—Ä—Ç–∫–∞:
python
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
class PGDatabase:
    def __init__(...):
        self.connection = psycopg2.connect(...)
        self.cursor = self.connection.cursor()
        self.connection.autocommit = True

    def post(self, query, args=()):
        try:
            self.cursor.execute(query, args)
        except Exception as err:
            print(repr(err))
–î–∞–Ω–Ω—ã–µ –≤—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü:
python
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
for i, row in df_orders_and_sales.iterrows():
    query = f"INSERT INTO orders_and_sales VALUES (...)"
    database.post(query)
________________________________________
üìä –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤ Metabase
Metabase –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ PostgreSQL. –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–∞—à–±–æ—Ä–¥—ã:
‚Ä¢	–ü—Ä–æ–¥–∞–∂–∏ –∏ –≤–æ–∑–≤—Ä–∞—Ç—ã –ø–æ SKU;
‚Ä¢	–ì–µ–æ–≥—Ä–∞—Ñ–∏—è –∑–∞–∫–∞–∑–æ–≤ –ø–æ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–º –æ–∫—Ä—É–≥–∞–º;
‚Ä¢	–¢–æ–ø-–±—Ä–µ–Ω–¥—ã –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏;
‚Ä¢	–î–∏–Ω–∞–º–∏–∫–∞ –∑–∞–∫–∞–∑–æ–≤ –ø–æ –¥–Ω—è–º.
–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å Metabase –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –¥–∞—Ç–µ, –±—Ä–µ–Ω–¥—É, —Ä–µ–≥–∏–æ–Ω—É.
________________________________________
üñ•Ô∏è –†–∞–∑–º–µ—â–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
–Ø —Ä–∞–∑–º–µ—Å—Ç–∏–ª –ø—Ä–æ–µ–∫—Ç –Ω–∞ —Å–≤–æ—ë–º Linux-—Å–µ—Ä–≤–µ—Ä–µ –∏ –Ω–∞—Å—Ç—Ä–æ–∏–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ cron.
–§–∞–π–ª crontab:
bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
0 7 * * * /usr/bin/python3 /home/user/scripts/wb_etl.py >> /home/user/logs/wb_etl.log 2>&1
–°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 07:00, –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è, –∏ –¥–∞—à–±–æ—Ä–¥—ã –≤ Metabase –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã.
________________________________________
‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç
‚Ä¢	–ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ETL-–ø—Ä–æ—Ü–µ—Å—Å;
‚Ä¢	PostgreSQL –∫–∞–∫ –µ–¥–∏–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ;
‚Ä¢	–£–¥–æ–±–Ω—ã–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ Metabase;
‚Ä¢	–°—Ç–∞–±–∏–ª—å–Ω–æ–µ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ —É—á–∞—Å—Ç–∏—è.
________________________________________
üöÄ –ü–ª–∞–Ω—ã –Ω–∞ —Ä–∞–∑–≤–∏—Ç–∏–µ
‚Ä¢	–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫;
‚Ä¢	–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —Å–ª—É—á–∞–µ —Å–±–æ—è;
‚Ä¢	–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –ø–∞–π–ø–ª–∞–π–Ω –≤ Airflow;
‚Ä¢	–°–¥–µ–ª–∞—Ç—å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∞–Ω–Ω—ã—Ö.
________________________________________
üìå –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Å—Ç–∞–ª –æ—Ç–ª–∏—á–Ω—ã–º –ø—Ä–∏–º–µ—Ä–æ–º –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Å–∫–≤–æ–∑–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–π —Ü–µ–ø–æ—á–∫–∏: –æ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –≤–Ω–µ—à–Ω–µ–≥–æ API –¥–æ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ BI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–µ.
–ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ ‚Äî –º–æ–≥—É –≤—ã–ª–æ–∂–∏—Ç—å —à–∞–±–ª–æ–Ω –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ GitHub.
–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–Ω–∏–º–∞–Ω–∏–µ! üôå

